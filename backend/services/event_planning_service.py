"""
Event Planning Service
ç”Ÿæˆä¸“ä¸šçš„æ¸¸æˆæ´»åŠ¨ç­–åˆ’æ¡ˆ
"""
from typing import Dict, Any, Optional
from services.openai_service import openai_service
from services.gpt_image_service import gpt_image_service

class EventPlanningService:
    def __init__(self):
        self.openai_service = openai_service
    
    async def generate_event_plan(self, form_data: Dict[str, Any]) -> Dict[str, Any]:
        """ç”Ÿæˆæ´»åŠ¨ç­–åˆ’æ¡ˆ"""
        try:
            # æ„å»ºè¯¦ç»†çš„prompt
            prompt = self._build_event_planning_prompt(form_data)
            
            # è°ƒç”¨OpenAI APIç”Ÿæˆç­–åˆ’æ¡ˆ
            messages = [
                {"role": "system", "content": "ä½ æ˜¯èµ„æ·±æ¸¸æˆæ´»åŠ¨ç­–åˆ’æ€»ç›‘ï¼Œä¸“é—¨è´Ÿè´£åˆ¶å®šä¸“ä¸šçº§ã€å¯ç›´æ¥æ‰§è¡Œçš„æ¸¸æˆæ´»åŠ¨ç­–åˆ’æ¡ˆã€‚"},
                {"role": "user", "content": prompt}
            ]
            
            response = await self.openai_service.get_chat_completion(
                messages=messages,
                temperature=0.7,
                max_tokens=4000
            )
            
            if response.get('success'):
                plan_content = response['content']
                
                # ç”ŸæˆUI mockupå›¾ç‰‡
                mockup_image = await self._generate_ui_mockup(form_data)
                
                return {
                    'success': True,
                    'plan': plan_content,
                    'mockup_image': mockup_image,
                    'form_data': form_data
                }
            else:
                return {
                    'success': False,
                    'error': response.get('error', 'ç”Ÿæˆç­–åˆ’æ¡ˆå¤±è´¥')
                }
                
        except Exception as e:
            return {
                'success': False,
                'error': f'ç”Ÿæˆç­–åˆ’æ¡ˆæ—¶å‘ç”Ÿé”™è¯¯: {str(e)}'
            }
    
    def _build_event_planning_prompt(self, form_data: Dict[str, Any]) -> str:
        """æ„å»ºæ´»åŠ¨ç­–åˆ’prompt"""
        
        # å¤„ç†ä¸šåŠ¡ç›®æ ‡
        business_goal = form_data.get('businessGoal', '')
        if business_goal == 'custom':
            business_goal_text = form_data.get('businessGoalCustom', '')
        else:
            goal_mapping = {
                'revenue': 'è¥æ”¶å¢é•¿',
                'retention': 'ç”¨æˆ·ç•™å­˜æå‡',
                'acquisition': 'æ–°ç”¨æˆ·è·å–',
                'engagement': 'ç”¨æˆ·æ´»è·ƒåº¦æå‡'
            }
            business_goal_text = goal_mapping.get(business_goal, business_goal)
        
        # å¤„ç†ç›®æ ‡ç©å®¶
        target_player = form_data.get('targetPlayer', '')
        if target_player == 'custom':
            target_player_text = form_data.get('targetPlayerCustom', '')
        else:
            player_mapping = {
                'whale': 'å¤§Rç©å®¶ï¼ˆé«˜ä»˜è´¹ç”¨æˆ·ï¼‰',
                'dolphin': 'ä¸­Rç©å®¶ï¼ˆä¸­ç­‰ä»˜è´¹ç”¨æˆ·ï¼‰',
                'minnow': 'å°Rç©å®¶ï¼ˆä½ä»˜è´¹ç”¨æˆ·ï¼‰',
                'f2p': 'å…è´¹ç©å®¶',
                'all': 'å…¨ä½“ç©å®¶'
            }
            target_player_text = player_mapping.get(target_player, target_player)
        
        prompt = f"""
**è§’è‰²ä¸ç›®æ ‡**
ä½ æ˜¯"èµ„æ·±æ¸¸æˆæ´»åŠ¨ç­–åˆ’æ€»ç›‘"ã€‚ä½ éœ€è¦åŸºäºç”¨æˆ·è¾“å…¥çš„éœ€æ±‚ï¼Œè¾“å‡ºä¸€ä»½**ä¸“ä¸šçº§ã€å¯ç›´æ¥æ‰§è¡Œçš„æ¸¸æˆæ´»åŠ¨ç­–åˆ’æ¡ˆ**ï¼ŒåŒ…å«å®Œæ•´çš„æ´»åŠ¨è®¾è®¡ã€å®æ–½æ–¹æ¡ˆã€èµ„æºé…ç½®å’Œæ•ˆæœé¢„æœŸã€‚

**ç”¨æˆ·éœ€æ±‚è¾“å…¥ï¼š**
* æ´»åŠ¨ä¸»é¢˜ï¼š{form_data.get('theme', '')}
* æ´»åŠ¨æ¦‚è¦ï¼š{form_data.get('overview', '')}
* ä¸šåŠ¡ç›®æ ‡ï¼š{business_goal_text}
* ç›®æ ‡ç©å®¶ï¼š{target_player_text}
* ç›®æ ‡åŒºåŸŸï¼š{form_data.get('targetRegion', '')}

**ç­–åˆ’åŸåˆ™**
* **ç”¨æˆ·ä¸­å¿ƒ**ï¼šä¼˜å…ˆè€ƒè™‘ç›®æ ‡ç©å®¶çš„ä½“éªŒå’Œéœ€æ±‚
* **å•†ä¸šé—­ç¯**ï¼šç¡®ä¿æ´»åŠ¨ç›®æ ‡å¯è¾¾æˆï¼ŒROIå¯è®¡ç®—
* **åˆ›æ–°èåˆ**ï¼šç»“åˆå½“å‰çƒ­ç‚¹è¶‹åŠ¿ï¼Œåˆ›é€ å·®å¼‚åŒ–ä½“éªŒ
* **é£é™©å¯æ§**ï¼šè®¾ç½®å®Œå–„çš„é£é™©é¢„æ¡ˆå’Œè°ƒæ•´æœºåˆ¶
* **æ•°æ®é©±åŠ¨**ï¼šæ‰€æœ‰è®¾è®¡å†³ç­–éƒ½è¦æœ‰é€»è¾‘æ”¯æ’‘

**è¾“å‡ºè¦æ±‚**
è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹æ ¼å¼è¾“å‡º

# ğŸ® {form_data.get('theme', '[æ´»åŠ¨åç§°]')} æ´»åŠ¨ç­–åˆ’æ¡ˆ

## ğŸ“‹ 1. UI mockupã€æ ¸å¿ƒç©æ³•è®¾è®¡

### æ–¹æ¡ˆAï¼šåˆ›æ–°ç©æ³•æ–¹æ¡ˆ
**æ ¸å¿ƒç©æ³•æœºåˆ¶**ï¼š
* ä¸»è¦ç©æ³•å¾ªç¯ï¼š[è¯¦ç»†æè¿°ç©å®¶çš„æ ¸å¿ƒæ“ä½œæµç¨‹]
* åé¦ˆæœºåˆ¶ï¼š[å³æ—¶åé¦ˆå’Œè¿›åº¦æ˜¾ç¤ºè®¾è®¡]
* å¥–åŠ±è·å–ï¼š[å¥–åŠ±ç±»å‹å’Œè·å–é€»è¾‘]
* ç¤¾äº¤å…ƒç´ ï¼š[ç©å®¶äº’åŠ¨å’Œç«äº‰æœºåˆ¶]

**UIç•Œé¢è®¾è®¡**ï¼š
* ä¸»ç•Œé¢å¸ƒå±€ï¼š[è¯¦ç»†æè¿°å„åŠŸèƒ½åŒºåŸŸåˆ’åˆ†]
* æ ¸å¿ƒæŒ‰é’®è®¾è®¡ï¼š[ä¸»è¦æ“ä½œå…¥å£çš„ä½ç½®å’Œæ ·å¼]
* ä¿¡æ¯å±•ç¤ºæ–¹å¼ï¼š[å…³é”®ä¿¡æ¯çš„å‘ˆç°é€»è¾‘]
* è§†è§‰å¼•å¯¼æµç¨‹ï¼š[ç”¨æˆ·æ“ä½œçš„å¼•å¯¼è®¾è®¡]

### æ–¹æ¡ˆBï¼šç»å…¸ä¼˜åŒ–æ–¹æ¡ˆ
**æ ¸å¿ƒç©æ³•æœºåˆ¶**ï¼š
* ä¸»è¦ç©æ³•å¾ªç¯ï¼š[åŸºäºæˆç†Ÿç©æ³•çš„ä¼˜åŒ–è®¾è®¡]
* åé¦ˆæœºåˆ¶ï¼š[ä¼˜åŒ–çš„åé¦ˆå’Œè¿›åº¦ç³»ç»Ÿ]
* å¥–åŠ±è·å–ï¼š[å¹³è¡¡çš„å¥–åŠ±åˆ†å‘æœºåˆ¶]
* ç¤¾äº¤å…ƒç´ ï¼š[å¼ºåŒ–çš„ç¤¾äº¤äº’åŠ¨è®¾è®¡]

**UIç•Œé¢è®¾è®¡**ï¼š
* ä¸»ç•Œé¢å¸ƒå±€ï¼š[ç”¨æˆ·å‹å¥½çš„ç•Œé¢è®¾è®¡]
* æ ¸å¿ƒæŒ‰é’®è®¾è®¡ï¼š[ç›´è§‚çš„æ“ä½œç•Œé¢]
* ä¿¡æ¯å±•ç¤ºæ–¹å¼ï¼š[æ¸…æ™°çš„ä¿¡æ¯æ¶æ„]
* è§†è§‰å¼•å¯¼æµç¨‹ï¼š[ç®€åŒ–çš„ç”¨æˆ·æµç¨‹]

### æ–¹æ¡ˆCï¼šæ··åˆåˆ›æ–°æ–¹æ¡ˆ
**æ ¸å¿ƒç©æ³•æœºåˆ¶**ï¼š
* ä¸»è¦ç©æ³•å¾ªç¯ï¼š[åˆ›æ–°ä¸ç»å…¸ç»“åˆçš„ç©æ³•]
* åé¦ˆæœºåˆ¶ï¼š[å¤šå±‚æ¬¡çš„åé¦ˆç³»ç»Ÿ]
* å¥–åŠ±è·å–ï¼š[å·®å¼‚åŒ–çš„å¥–åŠ±æœºåˆ¶]
* ç¤¾äº¤å…ƒç´ ï¼š[åˆ›æ–°çš„ç¤¾äº¤ç©æ³•]

**UIç•Œé¢è®¾è®¡**ï¼š
* ä¸»ç•Œé¢å¸ƒå±€ï¼š[å¹³è¡¡åˆ›æ–°ä¸æ˜“ç”¨æ€§]
* æ ¸å¿ƒæŒ‰é’®è®¾è®¡ï¼š[ä¸ªæ€§åŒ–çš„äº¤äº’è®¾è®¡]
* ä¿¡æ¯å±•ç¤ºæ–¹å¼ï¼š[åŠ¨æ€çš„ä¿¡æ¯å±•ç¤º]
* è§†è§‰å¼•å¯¼æµç¨‹ï¼š[æ²‰æµ¸å¼çš„ç”¨æˆ·ä½“éªŒ]

## ğŸ“… 2. æ´»åŠ¨æ—¶é—´è§„åˆ’

### æ•´ä½“æ—¶é—´è½´
**é¢„çƒ­æœŸï¼ˆæ´»åŠ¨å‰1å‘¨ï¼‰**
* å®£ä¼ é¢„å‘Šï¼š[å…·ä½“çš„é¢„çƒ­å†…å®¹å’Œæ¨å¹¿æ¸ é“]
* ç©å®¶æ•™è‚²ï¼š[ç©æ³•ä»‹ç»å’ŒæœŸå¾…å€¼ç®¡ç†]
* æŠ€æœ¯å‡†å¤‡ï¼š[ç³»ç»Ÿæµ‹è¯•å’Œæ€§èƒ½ä¼˜åŒ–]
* ç´ æå‡†å¤‡ï¼š[è§†è§‰ç´ æå’Œæ–‡æ¡ˆçš„æœ€ç»ˆç¡®è®¤]

**çˆ†å‘æœŸï¼ˆæ´»åŠ¨å‰3å¤©ï¼‰**
* é«˜å¼ºåº¦æ¨å¹¿ï¼š[å¤šæ¸ é“åŒæ­¥å‘åŠ›çš„å…·ä½“è®¡åˆ’]
* KOLåˆä½œï¼š[æ„è§é¢†è¢–çš„å†…å®¹æŠ•æ”¾ç­–ç•¥]
* ç¤¾åŒºé€ åŠ¿ï¼š[å®˜æ–¹ç¤¾åŒºçš„è¯é¢˜è®¨è®ºå’Œé¢„çº¦æ´»åŠ¨]
* æœ€ç»ˆæµ‹è¯•ï¼š[ä¸Šçº¿å‰çš„æœ€åæŠ€æœ¯éªŒè¯]

**æ´»åŠ¨æ‰§è¡ŒæœŸ**
* ç¬¬1å‘¨ï¼š[å¼€å±€å¸å¼•ç­–ç•¥ï¼Œå»ºç«‹ç”¨æˆ·ä¹ æƒ¯]
  - æ–°æ‰‹å¼•å¯¼ä¼˜åŒ–
  - åˆæœŸå¥–åŠ±ä¸°å¯Œ
  - é—®é¢˜å¿«é€Ÿå“åº”
* ç¬¬2-3å‘¨ï¼š[ç»´æŒçƒ­åº¦ç­–ç•¥ï¼Œæ·±åº¦å‚ä¸æ¿€åŠ±]
  - ä¸­æœŸæ´»åŠ¨é«˜æ½®
  - ç¤¾äº¤åŠŸèƒ½å¼ºåŒ–
  - ç”¨æˆ·åé¦ˆæ”¶é›†
* ç¬¬4å‘¨+ï¼š[æ”¶å°¾å†²åˆºç­–ç•¥ï¼Œæœ€ç»ˆè½¬åŒ–]
  - é™æ—¶ç‰¹æ®Šå¥–åŠ±
  - æ’è¡Œæ¦œç«äº‰
  - æˆå°±ç³»ç»Ÿå®Œå–„

**æ”¶å°¾æœŸï¼ˆæ´»åŠ¨å1å‘¨ï¼‰**
* æ•°æ®åˆ†æï¼š[å…¨é¢çš„æ•ˆæœè¯„ä¼°å’Œæ•°æ®æ€»ç»“]
* ç”¨æˆ·å›è®¿ï¼š[æ»¡æ„åº¦è°ƒç ”å’Œæ”¹è¿›å»ºè®®æ”¶é›†]
* ç»éªŒæ²‰æ·€ï¼š[æˆåŠŸç»éªŒçš„æ–‡æ¡£åŒ–å’Œæµç¨‹ä¼˜åŒ–]

## ğŸŒŸ 3. æ´»åŠ¨ä¸»é¢˜ä¸æ•…äº‹çº¿

### ä¸»é¢˜è®¾è®¡
**æ´»åŠ¨ä¸»é¢˜**ï¼š{form_data.get('theme', '')}
**æ•…äº‹èƒŒæ™¯**ï¼š[åŸºäºä¸»é¢˜çš„æ²‰æµ¸å¼èƒŒæ™¯è®¾å®šï¼Œç»“åˆç›®æ ‡ç©å®¶å–œå¥½]
**è§†è§‰é£æ ¼**ï¼š[ç¬¦åˆç›®æ ‡å¸‚åœºæ–‡åŒ–çš„è§†è§‰è°ƒæ€§è®¾è®¡]
**æƒ…æ„Ÿè¿æ¥**ï¼š[ä¸{target_player_text}çš„æƒ…æ„Ÿå…±é¸£ç‚¹è®¾è®¡]

### åˆ†é˜¶æ®µå‰§æƒ…è®¾è®¡
**ç¬¬ä¸€é˜¶æ®µï¼šå¼€å¯ç¯‡**
* æ•…äº‹èŠ‚ç‚¹ï¼š[å¼•å…¥æ€§çš„æ•…äº‹æƒ…èŠ‚ï¼Œå»ºç«‹ä¸–ç•Œè§‚]
* ç©å®¶ä½“éªŒï¼š[æ–°æ‰‹å‹å¥½çš„ä½“éªŒè®¾è®¡]
* æ ¸å¿ƒç©æ³•ï¼š[åŸºç¡€ç©æ³•çš„ä»‹ç»å’Œç»ƒä¹ ]
* å¥–åŠ±è®¾ç½®ï¼š[å¸å¼•æ€§çš„åˆæœŸå¥–åŠ±]

**ç¬¬äºŒé˜¶æ®µï¼šå‘å±•ç¯‡**
* æ•…äº‹èŠ‚ç‚¹ï¼š[æ·±å…¥çš„æ•…äº‹å‘å±•ï¼Œå¢åŠ å¤æ‚æ€§]
* ç©å®¶ä½“éªŒï¼š[è¿›é˜¶ç©æ³•çš„è§£é”å’ŒæŒ‘æˆ˜]
* æ ¸å¿ƒç©æ³•ï¼š[å®Œæ•´ç©æ³•ä½“éªŒçš„å±•å¼€]
* å¥–åŠ±è®¾ç½®ï¼š[æŒç»­æ¿€åŠ±çš„å¥–åŠ±æœºåˆ¶]

**ç¬¬ä¸‰é˜¶æ®µï¼šé«˜æ½®ç¯‡**
* æ•…äº‹èŠ‚ç‚¹ï¼š[æ•…äº‹é«˜æ½®ï¼Œæœ€ç»ˆæŒ‘æˆ˜]
* ç©å®¶ä½“éªŒï¼š[æœ€å…·æŒ‘æˆ˜æ€§å’Œå¥–åŠ±æ€§çš„å†…å®¹]
* æ ¸å¿ƒç©æ³•ï¼š[æ‰€æœ‰ç©æ³•å…ƒç´ çš„ç»¼åˆè¿ç”¨]
* å¥–åŠ±è®¾ç½®ï¼š[æœ€æœ‰ä»·å€¼çš„ç»ˆæå¥–åŠ±]

## ğŸ“Š 4. æ•ˆæœç›‘æµ‹ä¸é£é™©åº”æ€¥é¢„æ¡ˆ

### å…³é”®æŒ‡æ ‡ç›‘æµ‹ä½“ç³»
**å‚ä¸åº¦æŒ‡æ ‡**
* æ´»åŠ¨é¡µé¢è®¿é—®é‡ï¼šç›®æ ‡[å…·ä½“æ•°å­—]ä¸‡æ¬¡/æ—¥
* ä»»åŠ¡å®Œæˆç‡ï¼šç›®æ ‡[å…·ä½“ç™¾åˆ†æ¯”]%
* å¹³å‡å‚ä¸æ—¶é•¿ï¼šç›®æ ‡[å…·ä½“åˆ†é’Ÿ]åˆ†é’Ÿ/æ¬¡
* å›è®¿é¢‘æ¬¡ï¼šç›®æ ‡[å…·ä½“æ¬¡æ•°]æ¬¡/å‘¨

**è½¬åŒ–æŒ‡æ ‡**
* æ–°ç”¨æˆ·æ³¨å†Œï¼šç›®æ ‡å¢é•¿[å…·ä½“ç™¾åˆ†æ¯”]%
* ä»˜è´¹è½¬åŒ–ç‡ï¼šç›®æ ‡æå‡è‡³[å…·ä½“ç™¾åˆ†æ¯”]%
* å®¢å•ä»·å˜åŒ–ï¼šç›®æ ‡æå‡[å…·ä½“é‡‘é¢]å…ƒ
* ç•™å­˜ç‡å˜åŒ–ï¼šç›®æ ‡7æ—¥ç•™å­˜æå‡[å…·ä½“ç™¾åˆ†æ¯”]%

**ä¸šåŠ¡ç›®æ ‡è¾¾æˆæŒ‡æ ‡**
* ä¸»è¦ç›®æ ‡ï¼š{business_goal_text} - å…·ä½“æŒ‡æ ‡ï¼š[é‡åŒ–çš„æˆåŠŸæ ‡å‡†]
* æ¬¡è¦ç›®æ ‡1ï¼š[å…·ä½“æè¿°] - æŒ‡æ ‡ï¼š[é‡åŒ–æ ‡å‡†]
* æ¬¡è¦ç›®æ ‡2ï¼š[å…·ä½“æè¿°] - æŒ‡æ ‡ï¼š[é‡åŒ–æ ‡å‡†]

### é£é™©è¯†åˆ«ä¸åº”æ€¥é¢„æ¡ˆ
**è¿è¥é£é™©**
* å‚ä¸åº¦ä¸è¾¾é¢„æœŸ
  - é£é™©æŒ‡æ ‡ï¼šé¦–æ—¥å‚ä¸ç‡ä½äº[å…·ä½“ç™¾åˆ†æ¯”]%
  - åº”æ€¥æªæ–½ï¼š[å…·ä½“çš„è¡¥æ•‘æ–¹æ¡ˆï¼Œå¦‚å¥–åŠ±åŠ ç ã€ç©æ³•è°ƒæ•´]
* è´Ÿé¢èˆ†æƒ…é£é™©
  - é£é™©æŒ‡æ ‡ï¼šè´Ÿé¢è¯„ä»·è¶…è¿‡[å…·ä½“ç™¾åˆ†æ¯”]%
  - åº”æ€¥æªæ–½ï¼š[å…¬å…³ç­–ç•¥å’Œå†…å®¹è°ƒæ•´æ–¹æ¡ˆ]

**æŠ€æœ¯é£é™©**
* æœåŠ¡å™¨æ‰¿è½½é£é™©
  - é£é™©æŒ‡æ ‡ï¼šå“åº”æ—¶é—´è¶…è¿‡[å…·ä½“ç§’æ•°]ç§’
  - åº”æ€¥æªæ–½ï¼š[æ‰©å®¹æ–¹æ¡ˆå’Œé™çº§ç­–ç•¥]
* æ•°æ®å®‰å…¨é£é™©
  - é£é™©æŒ‡æ ‡ï¼šæ•°æ®å¼‚å¸¸æˆ–æ³„éœ²
  - åº”æ€¥æªæ–½ï¼š[æ•°æ®å¤‡ä»½å’Œå®‰å…¨å“åº”æµç¨‹]

**å¸‚åœºé£é™©**
* ç«å“å¹²æ‰°é£é™©
  - é£é™©æŒ‡æ ‡ï¼šç«å“åŒæœŸæ¨å‡ºç±»ä¼¼æ´»åŠ¨
  - åº”æ€¥æªæ–½ï¼š[å·®å¼‚åŒ–ç­–ç•¥å’Œè¥é”€åŠ ç æ–¹æ¡ˆ]

## ğŸ† 5. å¥–åŠ±ä½“ç³»è®¾è®¡

### é’ˆå¯¹{target_player_text}çš„å¥–åŠ±ç»“æ„
**ä¿åº•å¥–åŠ±ï¼ˆäººäººå¯å¾—ï¼‰**
* å¥–åŠ±å†…å®¹ï¼š[é€‚åˆç›®æ ‡ç©å®¶çš„åŸºç¡€ä»·å€¼ç‰©å“æ¸…å•]
* è·å–æ¡ä»¶ï¼š[ä½é—¨æ§›çš„å‚ä¸è¦æ±‚]
* å‘æ”¾èŠ‚å¥ï¼š[æ¯æ—¥/æ¯å‘¨çš„å¥–åŠ±åˆ†å¸ƒ]
* ä»·å€¼è¯„ä¼°ï¼š[å¯¹ç›®æ ‡ç©å®¶çš„å¸å¼•åŠ›åˆ†æ]

**è¿›é˜¶å¥–åŠ±ï¼ˆåŠªåŠ›å¯å¾—ï¼‰**
* å¥–åŠ±å†…å®¹ï¼š[ä¸­ç­‰ä»·å€¼çš„æ¿€åŠ±æ€§ç‰©å“]
* è·å–æ¡ä»¶ï¼š[é€‚ä¸­éš¾åº¦çš„æŒ‘æˆ˜è¦æ±‚]
* å‘æ”¾èŠ‚å¥ï¼š[ç»´æŒé•¿æœŸå‚ä¸çš„å¥–åŠ±èŠ‚å¥]
* ä»·å€¼è¯„ä¼°ï¼š[æ¿€åŠ±æŒç»­å‚ä¸çš„ä»·å€¼è®¾è®¡]

**ç¨€æœ‰å¥–åŠ±ï¼ˆå°‘æ•°è·å¾—ï¼‰**
* å¥–åŠ±å†…å®¹ï¼š[é«˜ä»·å€¼çš„ç¨€æœ‰ç‰©å“ï¼Œç¬¦åˆç›®æ ‡ç©å®¶åå¥½]
* è·å–æ¡ä»¶ï¼š[é«˜éš¾åº¦æˆ–é«˜æŠ•å…¥çš„è¦æ±‚]
* ç¨€æœ‰åº¦æ§åˆ¶ï¼š[é™é‡å‘æ”¾ç­–ç•¥]
* ä»·å€¼è¯„ä¼°ï¼š[åˆ›é€ ç‹¬ç‰¹æ€§å’Œç‚«è€€ä»·å€¼]

**æƒŠå–œå¥–åŠ±ï¼ˆéšæœºè·å¾—ï¼‰**
* å¥–åŠ±å†…å®¹ï¼š[è¶…é¢„æœŸä»·å€¼çš„ç‰¹æ®Šç‰©å“]
* è§¦å‘æœºåˆ¶ï¼š[éšæœºäº‹ä»¶æˆ–éšè—æ¡ä»¶]
* æƒŠå–œç¨‹åº¦ï¼š[å¿ƒç†æ»¡è¶³æ„Ÿçš„è®¾è®¡è€ƒé‡]
* ä»·å€¼è¯„ä¼°ï¼š[å¢å¼ºæ´»åŠ¨è®°å¿†ç‚¹å’Œè¯é¢˜æ€§]

### å¥–åŠ±åˆ†å‘ç­–ç•¥
* **æ—¶é—´åˆ†å¸ƒ**ï¼š[å¥–åŠ±åœ¨æ´»åŠ¨æœŸé—´çš„åˆ†å‘æ—¶é—´å®‰æ’]
* **éš¾åº¦æ¢¯åº¦**ï¼š[ä»æ˜“åˆ°éš¾çš„å¥–åŠ±è·å–è·¯å¾„è®¾è®¡]
* **ä»·å€¼é€’å¢**ï¼š[å¥–åŠ±ä»·å€¼çš„é€æ­¥æå‡é€»è¾‘]
* **ä¸ªæ€§åŒ–æ¨è**ï¼š[åŸºäºç©å®¶è¡Œä¸ºçš„ä¸ªæ€§åŒ–å¥–åŠ±]

## ğŸ’° 6. æ´»åŠ¨åˆ¶ä½œæˆæœ¬ä¸äººå¤©éœ€æ±‚

### å¼€å‘æˆæœ¬ä¼°ç®—
**ç­–åˆ’è®¾è®¡**
* æ´»åŠ¨ç­–åˆ’ï¼š2äºº Ã— 5å·¥ä½œæ—¥ = 10äººå¤©
* ç³»ç»Ÿè®¾è®¡ï¼š1äºº Ã— 3å·¥ä½œæ—¥ = 3äººå¤©
* æ•°å€¼å¹³è¡¡ï¼š1äºº Ã— 2å·¥ä½œæ—¥ = 2äººå¤©

**ç¾æœ¯åˆ¶ä½œ**
* UIç•Œé¢è®¾è®¡ï¼š2äºº Ã— 8å·¥ä½œæ—¥ = 16äººå¤©
* æ´»åŠ¨ç´ æåˆ¶ä½œï¼š3äºº Ã— 10å·¥ä½œæ—¥ = 30äººå¤©
* ç‰¹æ•ˆåˆ¶ä½œï¼š1äºº Ã— 5å·¥ä½œæ—¥ = 5äººå¤©

**ç¨‹åºå¼€å‘**
* å‰ç«¯å¼€å‘ï¼š2äºº Ã— 12å·¥ä½œæ—¥ = 24äººå¤©
* åç«¯å¼€å‘ï¼š2äºº Ã— 10å·¥ä½œæ—¥ = 20äººå¤©
* æ•°æ®ç»Ÿè®¡ï¼š1äºº Ã— 3å·¥ä½œæ—¥ = 3äººå¤©

**æµ‹è¯•è°ƒä¼˜**
* åŠŸèƒ½æµ‹è¯•ï¼š2äºº Ã— 5å·¥ä½œæ—¥ = 10äººå¤©
* æ€§èƒ½ä¼˜åŒ–ï¼š1äºº Ã— 3å·¥ä½œæ—¥ = 3äººå¤©
* å…¼å®¹æ€§æµ‹è¯•ï¼š1äºº Ã— 2å·¥ä½œæ—¥ = 2äººå¤©

**æ€»è®¡å¼€å‘æˆæœ¬**ï¼š128äººå¤©

### è¿è¥æˆæœ¬ä¼°ç®—
**æ¨å¹¿è´¹ç”¨**
* çº¿ä¸Šå¹¿å‘ŠæŠ•æ”¾ï¼š[åŸºäºç›®æ ‡å¸‚åœºçš„é¢„ç®—ä¼°ç®—]
* KOLåˆä½œè´¹ç”¨ï¼š[æ„è§é¢†è¢–åˆä½œçš„æˆæœ¬]
* ç¤¾äº¤åª’ä½“æ¨å¹¿ï¼š[ç¤¾åª’å¹³å°çš„æ¨å¹¿é¢„ç®—]

**å¥–åŠ±æˆæœ¬**
* è™šæ‹Ÿç‰©å“ä»·å€¼ï¼š[æ¸¸æˆå†…å¥–åŠ±çš„ä»·å€¼æ¢ç®—]
* å®ç‰©å¥–å“ï¼š[å¦‚æœ‰å®ç‰©å¥–åŠ±çš„é‡‡è´­æˆæœ¬]
* å¹³å°åˆ†æˆï¼š[ç¬¬ä¸‰æ–¹å¹³å°çš„åˆ†æˆè´¹ç”¨]

**äººåŠ›æˆæœ¬**
* æ´»åŠ¨è¿è¥ï¼š2äºº Ã— æ´»åŠ¨å‘¨æœŸ
* å®¢æœæ”¯æŒï¼šå¢åŠ 1äºº Ã— æ´»åŠ¨å‘¨æœŸ
* æ•°æ®åˆ†æï¼š1äºº Ã— æ´»åŠ¨å‘¨æœŸ + åç»­1å‘¨

### ROIé¢„æœŸ
**æ”¶ç›Šé¢„æµ‹**
* ç›´æ¥æ”¶ç›Šï¼šæ´»åŠ¨æœŸé—´é¢„æœŸè¥æ”¶å¢é•¿[å…·ä½“é‡‘é¢]
* é—´æ¥æ”¶ç›Šï¼šç”¨æˆ·å¢é•¿å¸¦æ¥çš„é•¿æœŸä»·å€¼[å…·ä½“ä¼°ç®—]
* å“ç‰Œä»·å€¼ï¼šçŸ¥ååº¦å’Œç”¨æˆ·æ»¡æ„åº¦æå‡çš„ä»·å€¼

**æŠ•èµ„å›æŠ¥ç‡**
* çŸ­æœŸROIï¼šæ´»åŠ¨æœŸé—´æŠ•å…¥äº§å‡ºæ¯”é¢„æœŸ[å…·ä½“æ¯”ä¾‹]
* é•¿æœŸROIï¼š3-6ä¸ªæœˆç»¼åˆæ”¶ç›Šé¢„æœŸ[å…·ä½“æ¯”ä¾‹]
* é£é™©è°ƒæ•´ROIï¼šè€ƒè™‘å„ç§é£é™©å› ç´ åçš„ä¿å®ˆä¼°ç®—

---

**ç­–åˆ’æ¡ˆæ€»ç»“**
æœ¬æ´»åŠ¨ç­–åˆ’æ¡ˆåŸºäºç”¨æˆ·éœ€æ±‚"{form_data.get('theme', '')}"ï¼Œé’ˆå¯¹{target_player_text}ç¾¤ä½“ï¼Œä»¥{business_goal_text}ä¸ºæ ¸å¿ƒç›®æ ‡ï¼Œè®¾è®¡äº†å®Œæ•´çš„æ´»åŠ¨æ–¹æ¡ˆã€‚é€šè¿‡ä¸‰å¥—UI mockupæ–¹æ¡ˆæä¾›é€‰æ‹©ç©ºé—´ï¼Œè¯¦ç»†çš„æ—¶é—´è§„åˆ’ç¡®ä¿æ‰§è¡Œæœ‰åºï¼Œä¸°å¯Œçš„æ•…äº‹çº¿å¢å¼ºç©å®¶æ²‰æµ¸æ„Ÿï¼Œå®Œå–„çš„ç›‘æµ‹ä½“ç³»ä¿éšœæ•ˆæœè¾¾æˆï¼Œç§‘å­¦çš„å¥–åŠ±è®¾è®¡æ¿€åŠ±æŒç»­å‚ä¸ï¼Œåˆç†çš„æˆæœ¬æ§åˆ¶ç¡®ä¿å•†ä¸šä»·å€¼ã€‚æ•´ä½“æ–¹æ¡ˆå…·å¤‡å¯æ‰§è¡Œæ€§ã€åˆ›æ–°æ€§å’Œå•†ä¸šä»·å€¼ï¼Œé¢„æœŸèƒ½å¤Ÿæœ‰æ•ˆè¾¾æˆè®¾å®šçš„ä¸šåŠ¡ç›®æ ‡ã€‚
"""
        
        return prompt
    
    async def _generate_ui_mockup(self, form_data: Dict[str, Any]) -> Optional[str]:
        """ç”ŸæˆUI mockupå›¾ç‰‡"""
        try:
            # æ„å»ºUI mockupçš„prompt
            mockup_prompt = self._build_mockup_prompt(form_data)
            
            # è°ƒç”¨GPTå›¾åƒç”ŸæˆæœåŠ¡
            result = await gpt_image_service.generate_image(mockup_prompt, 1536, 1024)
            
            if result.get('success'):
                return result.get('image_base64')
            else:
                print(f"UI mockupç”Ÿæˆå¤±è´¥: {result.get('error')}")
                return None
                
        except Exception as e:
            print(f"ç”ŸæˆUI mockupæ—¶å‘ç”Ÿé”™è¯¯: {str(e)}")
            return None
    
    def _build_mockup_prompt(self, form_data: Dict[str, Any]) -> str:
        """æ„å»ºUI mockupç”Ÿæˆçš„prompt"""
        theme = form_data.get('theme', 'æ¸¸æˆæ´»åŠ¨')
        overview = form_data.get('overview', '')
        
        # å¤„ç†ä¸šåŠ¡ç›®æ ‡
        business_goal = form_data.get('businessGoal', '')
        if business_goal == 'custom':
            business_goal_text = form_data.get('businessGoalCustom', '')
        else:
            goal_mapping = {
                'revenue': 'è¥æ”¶å¢é•¿',
                'retention': 'ç”¨æˆ·ç•™å­˜æå‡',
                'acquisition': 'æ–°ç”¨æˆ·è·å–',
                'engagement': 'ç”¨æˆ·æ´»è·ƒåº¦æå‡'
            }
            business_goal_text = goal_mapping.get(business_goal, business_goal)
        
        # å¤„ç†ç›®æ ‡ç©å®¶
        target_player = form_data.get('targetPlayer', '')
        if target_player == 'custom':
            target_player_text = form_data.get('targetPlayerCustom', '')
        else:
            player_mapping = {
                'whale': 'å¤§Rç©å®¶',
                'dolphin': 'ä¸­Rç©å®¶',
                'minnow': 'å°Rç©å®¶',
                'f2p': 'å…è´¹ç©å®¶',
                'all': 'å…¨ä½“ç©å®¶'
            }
            target_player_text = player_mapping.get(target_player, target_player)
        
        # ä¼˜åŒ–çš„UI mockup prompt - ä¸ç­–åˆ’æ¡ˆä¿æŒä¸€è‡´
        mockup_prompt = f"""ç”Ÿæˆä¸€ä¸ªä¸“ä¸šçš„æ¸¸æˆæ´»åŠ¨UI mockupåŸå‹å›¾ï¼š

ã€æ ¸å¿ƒè¦æ±‚ã€‘
ğŸ¯ æ´»åŠ¨ä¸»é¢˜ï¼š{theme}
ğŸ“ æ´»åŠ¨æ¦‚è¦ï¼š{overview}
ğŸ‘¥ ç›®æ ‡ç”¨æˆ·ï¼š{target_player_text}
ğŸ’¼ ä¸šåŠ¡ç›®æ ‡ï¼š{business_goal_text}

ã€ç•Œé¢è®¾è®¡è§„èŒƒã€‘
è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹å¸ƒå±€ç”Ÿæˆç§»åŠ¨ç«¯æ¸¸æˆUIåŸå‹å›¾ï¼š

é¡¶éƒ¨åŒºåŸŸï¼ˆå å±å¹•ä¸Šæ–¹20%ï¼‰ï¼š
- å·¦ä¸Šï¼š"{theme}"æ´»åŠ¨æ ‡é¢˜Logo
- å³ä¸Šï¼šå‰©ä½™æ—¶é—´å€’è®¡æ—¶
- ä¸­é—´ï¼šå½“å‰æ´»åŠ¨è¿›åº¦æ¡/ç­‰çº§æ˜¾ç¤º

ä¸­å¤®æ ¸å¿ƒåŒºåŸŸï¼ˆå å±å¹•ä¸­å¤®60%ï¼‰ï¼š
- ä¸»è¦åŠŸèƒ½ï¼šæ ¹æ®"{overview}"çš„å…·ä½“æè¿°è®¾è®¡å¯¹åº”çš„æ ¸å¿ƒäº¤äº’åŒºåŸŸ
- çªå‡º{business_goal_text}ç›®æ ‡çš„å…³é”®åŠŸèƒ½æŒ‰é’®
- ç¬¦åˆ{target_player_text}ä½¿ç”¨ä¹ æƒ¯çš„äº¤äº’å¸ƒå±€

åº•éƒ¨åŠŸèƒ½åŒºï¼ˆå å±å¹•ä¸‹æ–¹20%ï¼‰ï¼š
- å·¦ä¸‹ï¼šä¸ªäººä¿¡æ¯/è¿›åº¦
- ä¸­ä¸‹ï¼šä¸»è¦æ“ä½œæŒ‰é’®
- å³ä¸‹ï¼šå•†åº—/å¥–åŠ±å…¥å£

ã€è§†è§‰è§„èŒƒã€‘
- é£æ ¼ï¼šä½ä¿çœŸçº¿æ¡†å›¾ï¼Œé»‘ç™½ç°è‰²è°ƒ
- æ ‡å‡†ï¼šç§»åŠ¨ç«¯æ¸¸æˆUIè®¾è®¡è§„èŒƒ
- å¸ƒå±€ï¼šæ¸…æ™°çš„åŠŸèƒ½åŒºåŸŸåˆ’åˆ†ï¼Œæ˜“äºç†è§£
- é‡ç‚¹ï¼šçªå‡ºæ ¸å¿ƒç©æ³•å’Œä¸šåŠ¡ç›®æ ‡ç›¸å…³åŠŸèƒ½
"""
        
        return mockup_prompt

# åˆ›å»ºå…¨å±€å®ä¾‹
event_planning_service = EventPlanningService()
